
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Make a Model Searchable by Tags Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="migrations.html" />
    
    
    <link rel="prev" href="creating-a-dynamic-page.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../development/getting_started.html">
            
                <a href="../development/getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../deployment/habitat.html">
            
                <a href="../deployment/habitat.html">
            
                    
                    Deploy a Site with Chef Habitat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../deployment/docker.html">
            
                <a href="../deployment/docker.html">
            
                    
                    Deploy a Site with Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Guides
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="creating-a-dynamic-page.html">
            
                <a href="creating-a-dynamic-page.html">
            
                    
                    Creating a Dynamic Page
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="make-a-model-searchable-by-tags.html">
            
                <a href="make-a-model-searchable-by-tags.html">
            
                    
                    Make a Model Searchable by Tags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="migrations.html">
            
                <a href="migrations.html">
            
                    
                    Migrations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="skeletons-from-scratch.html">
            
                <a href="skeletons-from-scratch.html">
            
                    
                    Bootstrap a Site from Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="translating-sites.html">
            
                <a href="translating-sites.html">
            
                    
                    Translating a Site into Multiple Languages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="sending-email.html">
            
                <a href="sending-email.html">
            
                    
                    Sending Emails
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Make a Model Searchable by Tags</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="make-a-model-searchable-by-tags">Make a Model Searchable by Tags</h1>
<p>To make a model searchable by tags, we&apos;ll make use of the <code>callback</code> option for <code>$searchConditions</code> to specify a function that can generate advanced SQL procedurally.</p>
<p>First, define a new search condition:</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModel</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">ActiveRecord</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> $searchConditions = [
        <span class="hljs-string">&apos;Tags&apos;</span> =&gt; [
            <span class="hljs-string">&apos;qualifiers&apos;</span> =&gt; [<span class="hljs-string">&apos;any&apos;</span>, <span class="hljs-string">&apos;tag&apos;</span>, <span class="hljs-string">&apos;tags&apos;</span>],
            <span class="hljs-string">&apos;points&apos;</span> =&gt; <span class="hljs-number">2</span>,
            <span class="hljs-string">&apos;callback&apos;</span> =&gt; <span class="hljs-string">&apos;getTagsSearchConditions&apos;</span>
        ]
    ];

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>The <code>callback</code> option can take any PHP <code>callable</code>, or a simple string referencing a public static method on the model class. This method will be called for each term in the search query and should return an SQL expression to match records that match this term. The ultimate results list gets sorted by how many terms are matched.</p>
<p>While it is possible to implement joins via <code>$searchConditions</code>, in this example we are instead going to &quot;unroll&quot; any matching tags ahead of time into a list of tagged record IDs while the search query is being prepared:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTagsSearchConditions</span><span class="hljs-params">($term)</span>
    </span>{
        $ids = \DB::allValues(
            <span class="hljs-string">&apos;ContextID&apos;</span>,
            <span class="hljs-string">&apos;
            SELECT TagItem.ContextID
              FROM `%1$s` Tag
              JOIN `%2$s` TagItem
                ON TagItem.TagID = Tag.ID AND TagItem.ContextClass = &quot;%3$s&quot;
             WHERE Tag.Title LIKE &quot;%%%4$s%%&quot; OR Tag.Handle LIKE &quot;%%%4$s%%&quot;
            &apos;</span>,
            [
                \Tag::$tableName, <span class="hljs-comment">// %1$s</span>
                \TagItem::$tableName, <span class="hljs-comment">// %2$s</span>
                \DB::escape(<span class="hljs-keyword">static</span>::getStaticRootClass()), <span class="hljs-comment">// %3$s</span>
                \DB::escape($term) <span class="hljs-comment">// %4$s</span>
            ]
        );

        <span class="hljs-keyword">return</span> count($ids) ? <span class="hljs-string">&apos;ID IN (&apos;</span>.implode(<span class="hljs-string">&apos;,&apos;</span>,$ids).<span class="hljs-string">&apos;)&apos;</span> : <span class="hljs-string">&apos;0&apos;</span>;
    }
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="creating-a-dynamic-page.html" class="navigation navigation-prev " aria-label="Previous page: Creating a Dynamic Page">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="migrations.html" class="navigation navigation-next " aria-label="Next page: Migrations">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Make a Model Searchable by Tags","level":"1.4.2","depth":2,"next":{"title":"Migrations","level":"1.4.3","depth":2,"path":"guides/migrations.md","ref":"guides/migrations.md","articles":[]},"previous":{"title":"Creating a Dynamic Page","level":"1.4.1","depth":2,"path":"guides/creating-a-dynamic-page.md","ref":"guides/creating-a-dynamic-page.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"guides/make-a-model-searchable-by-tags.md","mtime":"2019-11-06T01:29:26.854Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-06T01:29:28.951Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

