
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Using Studio Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="console-command.html" />
    
    
    <link rel="prev" href="getting_started.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="getting_started.html">
            
                <a href="getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="studio.html">
            
                <a href="studio.html">
            
                    
                    Using Studio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="console-command.html">
            
                <a href="console-command.html">
            
                    
                    Build a Console Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="site-specific-service.html">
            
                <a href="site-specific-service.html">
            
                    
                    Build a Site-specific Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../deployment/habitat.html">
            
                <a href="../deployment/habitat.html">
            
                    
                    Deploy a Site with Chef Habitat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../deployment/docker.html">
            
                <a href="../deployment/docker.html">
            
                    
                    Deploy a Site with Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Guides
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../guides/migrate-site-to-holobranch.html">
            
                <a href="../guides/migrate-site-to-holobranch.html">
            
                    
                    Migrate a Site to a Holobranch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../guides/creating-a-dynamic-page.html">
            
                <a href="../guides/creating-a-dynamic-page.html">
            
                    
                    Creating a Dynamic Page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../guides/make-a-model-searchable-by-tags.html">
            
                <a href="../guides/make-a-model-searchable-by-tags.html">
            
                    
                    Make a Model Searchable by Tags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../guides/migrations.html">
            
                <a href="../guides/migrations.html">
            
                    
                    Migrations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../guides/skeletons-from-scratch.html">
            
                <a href="../guides/skeletons-from-scratch.html">
            
                    
                    Bootstrap a Site from Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../guides/translating-sites.html">
            
                <a href="../guides/translating-sites.html">
            
                    
                    Translating a Site into Multiple Languages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../guides/sending-email.html">
            
                <a href="../guides/sending-email.html">
            
                    
                    Sending Emails
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Using Studio</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="development-using-studio">Development: Using Studio</h1>
<p>This guide shows you how to set up a local Studio environment for interactively developing your site.</p>
<h2 id="in-this-article">In this article</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#add-studiorc-to-repository">Add <code>.studiorc</code> to Repository</a></li>
<li><a href="#enter-studio">Enter Studio</a></li>
<li><a href="#load-a-database-service">Load a Database Service</a></li>
<li><a href="#load-a-runtime-service">Load a Runtime Service</a></li>
<li><a href="#load-an-http-service">Load an HTTP Service</a></li>
<li><a href="#studio-commands-reference">Studio Commands Reference</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p><a href="https://github.com/EmergencePlatform/studio/" target="_blank">Emergence Studio</a> uses <a href="https://www.habitat.sh/docs/developing-packages/#plan-builds" target="_blank">Chef Habitat Studio</a> to provide an isolated, disposable, and interactive command-line environment for working on your site.</p>
<p>In this and other guides, we will focus on running Linux-like Studio environments contained by Docker, as that provides the most consistent developer experience across platforms. On Linux machines, Chef Habitat <a href="https://www.habitat.sh/docs/developing-packages/#managing-the-studio-type-docker-linux-windows" target="_blank">also can provide a chroot-contained Studio type</a> that is faster, smaller, persistent by default, and exposes all network ports. Chroot studios offer lower overhead in CI and controlled environments, and will work just as well with Emergence Studio, but require more awareness of what else is in the environment to avoid conflicts.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Complete the <a href="getting_started.html#prerequisites">prerequisites covered in Development: Getting Started</a></li>
</ul>
<h2 id="add-studiorc-to-repository">Add <code>.studiorc</code> to Repository</h2>
<p>While entering a Chef Habitat Studio, any <code>.studiorc</code> script present in the root of the directory where the <code>hab studio enter</code> command is run will be sourced and executed automatically during the Studio&apos;s initialization, before the interactive command line is presented.</p>
<p>Use this <code>.studiorc</code> template as a starting point in the root of any emergence site project:</p>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash</span>
hab pkg install emergence/studio
<span class="hljs-built_in">source</span> <span class="hljs-string">&quot;<span class="hljs-variable">$(hab pkg path emergence/studio)</span>/studio.sh&quot;</span>
</code></pre>
<p>This script installs and loads the Emergence Studio environment and commands. You may add any additional code here to extend the studio environment for your project.</p>
<h2 id="enter-studio">Enter Studio</h2>
<pre><code class="lang-bash"><span class="hljs-comment"># start from the root of your project repository</span>
<span class="hljs-built_in">cd</span> /path/to/my-repo/

<span class="hljs-comment"># use your chosen/registered origin name</span>
<span class="hljs-built_in">export</span> HAB_ORIGIN=<span class="hljs-string">&quot;myorigin&quot;</span>

<span class="hljs-comment"># pass options to Docker to open ports, persist mysql data, name container</span>
<span class="hljs-built_in">export</span> HAB_DOCKER_OPTS=<span class="hljs-string">&quot;
    -p 7080:80
    -p 7043:443
    -p 7036:3306
    -p 7099:19999
    -v mysite-mysql-data:/hab/svc/mysql/data
    --name mysite-studio
&quot;</span>

<span class="hljs-comment"># launch and enter interactive Habitat studio, forcing Docker mode</span>
hab studio enter -D
</code></pre>
<h2 id="load-a-database-service">Load a Database Service</h2>
<p>Start a database service before any other. Your runtime service instance can have its <code>database</code> slot bound to an instance of <code>core/mysql</code>, <code>jarvus/mysql-remote</code>, or any other Chef Habitat service with compatible config exposure leading to a MySQL server connection.</p>
<p>Any approach must export <code>$DB_SERVICE</code> and <code>$DB_DATABASE</code> into your studio environment.</p>
<h3 id="use-coremysql-to-run-a-local-database">Use <code>core/mysql</code> to run a local database</h3>
<pre><code class="lang-bash">start-mysql
</code></pre>
<p>That&apos;s it! A local MySQL instance will be set up using <a href="https://github.com/habitat-sh/core-plans/tree/master/mysql" target="_blank"><code>core/mysql</code></a> with persistent data stored under <code>/hab/svc/mysql/data</code>. The example <code>HAB_DOCKER_OPTS</code> above includes mounting this path to a named volume and exposing the MySQL port to your host machine on <code>7036</code>.</p>
<p>Use <code>hab svc status</code> and <code>sup-log</code> to verify the database service is up and running without any errors. If you see any permission denied errors under <code>sup-log</code>, that likely indicates the volume mounted at <code>/hab/svc/mysql/data</code> did not initialize with permissions adequate for the MySQL service to write there, and can be fixed for the lifetime of that volume by running <code>chown hab:hab -R /hab/svc/mysql/data</code></p>
<h3 id="use-jarvusmysql-remote-to-connect-a-remote-database">Use <code>jarvus/mysql-remote</code> to connect a remote database</h3>
<pre><code class="lang-bash">start-mysql-remote <span class="hljs-string">&quot;mydatabasename&quot;</span>
</code></pre>
<p>This studio command will launch an editor to populate <code>/hab/user/mysql-remote/config/user.toml</code> with connection details and then load a <a href="https://github.com/JarvusInnovations/habitat-plans/tree/master/mysql-remote" target="_blank"><code>jarvus/mysql-remote</code></a> service instance.</p>
<h2 id="load-a-runtime-service">Load a Runtime Service</h2>
<p>With a database service successfully loaded, you can load a runtime service. The runtime service provides the PHP worker pool and loads your site code into it.</p>
<pre><code class="lang-bash">start-runtime
</code></pre>
<p>This studio command will load an instance of the generic <a href="https://github.com/EmergencePlatform/php-runtime" target="_blank"><code>emergence/php-runtime</code></a> service that any site can be loaded into. The <code>$DB_SERVICE</code> environment variable exported when you ran one of the <code>start-mysql*</code> studio commands previously will be used to bind this runtime instance&apos;s <code>database</code> slot to your database instance.</p>
<p>The guide <a href="development/site-specific-service.md">Development: Build a Site-specific Service</a> covers how to build and use your own runtime service package that can extend and bundle your site into its own deployable artifact.</p>
<p>Any approach must export <code>$EMERGENCE_RUNTIME</code> into your studio environment.</p>
<h2 id="load-an-http-service">Load an HTTP Service</h2>
<p>Finally, with the database and runtime services successfully loaded, you can load an HTTP service to expose your application.</p>
<pre><code class="lang-bash">start-http
</code></pre>
<p>This studio command will load an instance of the generic <a href="https://github.com/EmergencePlatform/habitat-plans/tree/master/nginx" target="_blank"><code>emergence/nginx</code></a> service. The <code>$EMERGENCE_RUNTIME</code> environment variable exported when you ran the <code>start-runtime</code> studio command previously will be used to bind this nginx instance&apos;s <code>backend</code> slot to your runtime instance.</p>
<p>The example <code>HAB_DOCKER_OPTS</code> above includes exposing nginx&apos;s HTTP and HTTPS ports to your host machine on <code>7080</code> and <code>7043</code> respectively.</p>
<h2 id="studio-commands-reference">Studio Commands Reference</h2>
<h3 id="runtime">Runtime</h3>
<ul>
<li><code>update-site</code> &#x2014; Projects your site tree with Hologit and loads it into the current runtime service instance<ul>
<li>Affected by <code>$EMERGENCE_REPO</code>, <code>$EMERGENCE_HOLOBRANCH</code>, and <code>$EMERGENCE_FETCH</code> environment variables</li>
</ul>
</li>
<li><code>watch-site</code> &#x2014; Like <code>update-site</code>, but runs until terminated, watching for file changes and re-updating the site automatically</li>
<li><code>shell-runtime</code> &#x2014; Opens an interactive <a href="https://psysh.org/" target="_blank">PsySH</a> shell under the same environment used by the currently-loaded runtime instance</li>
<li><code>switch-site /path/to/repository/</code> &#x2014; Switches what site repository will be used next time you run <code>update-site</code> (the default is whichever <code>.studiorc</code> was loaded from)</li>
<li><code>console-run [command] &lt;args...&gt;</code> &#x2014; Executes a script from the <code>console-commands/</code> site tree within the current runtime</li>
<li><code>enable-xdebug 192.168.1.1</code> &#x2014; Enables using a remote Xdebug debugger at an IP/hostname reachable from inside the container</li>
<li><code>enable-runtime-update</code> &#x2014; When using a site-specific runtime service, enables using <code>update-site</code> as you can with the generic <code>emergence/php-runtime</code> service (instead of using the site build bundled with the service).</li>
</ul>
<h3 id="database">Database</h3>
<ul>
<li><code>load-sql [-|file...|URL|site] [database]</code> &#x2014; Load one or more .sql files into the current database instance</li>
<li><code>dump-sql [database] &gt; file.sql</code> &#x2014; Dump the current database to SQL</li>
<li><code>reset-mysql</code> &#x2014; Drop and recreate empty the current database</li>
<li><code>promote-user &lt;username&gt; [account_level]</code> &#x2014; Promote a user in the database to a higher account level after registration</li>
<li><code>shell-mysql</code> &#x2014; Open an interactive MySQL client shell under the currently-loaded database instance</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="getting_started.html" class="navigation navigation-prev " aria-label="Previous page: Getting Started">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="console-command.html" class="navigation navigation-next " aria-label="Next page: Build a Console Command">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Using Studio","level":"1.2.2","depth":2,"next":{"title":"Build a Console Command","level":"1.2.3","depth":2,"path":"development/console-command.md","ref":"development/console-command.md","articles":[]},"previous":{"title":"Getting Started","level":"1.2.1","depth":2,"path":"development/getting_started.md","ref":"development/getting_started.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"development/studio.md","mtime":"2020-04-12T17:37:20.357Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-04-12T17:37:22.309Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

